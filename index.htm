<!DOCTYPE html>

<html manifest="manifest.appcache">

    <head>
        <title>Inventos MGM</title>

        <meta name="viewport" content="width=device-width, initial-scale = 1, maximum-scale=1.0, user-scalable=no">
        <link rel="apple-touch-icon-precomposed" href="assets/icon/apple-touch-icon-144.png" sizes="144x144">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="format-detection" content="telephone=no">
        <link href="assets/startup/startup-portrait.png"
              media="(device-width: 768px) and (device-height: 1024px)
                 and (orientation: portrait)
                 and (-webkit-device-pixel-ratio: 2)"
              rel="apple-touch-startup-image">
              
        <link href="assets/startup/startup.png"
              media="(device-width: 768px) and (device-height: 1024px)
                 and (orientation: landscape)
                 and (-webkit-device-pixel-ratio: 2)"
              rel="apple-touch-startup-image">
              
        <link rel="stylesheet" href="style.css">
    </head>
    
    <body>
        
        <div id="helpScreen" style="display: none;"></div>
        <div id="infoModal" class='hidden'style="display: none;"><div class='closeBTN'></div></div>
        <div id="navbar">
            <div id="BTNback"></div>
            <div id="BTNtitle"></div>
            <div id="BTN3d"></div>
            <div id="BTNaudioControl"></div>
            <div id="BTNhelp"></div>
            <div id="BTNinfo"></div>
        </div>
        
        <img id="backgroundAnimation" width="1024"></div>
        <div id="mainView">
            <div id="setaEsquerda" class="leaveState"></div>
            <div id="setaDireita"></div>
            <img src="assets/menu/toque.png" id="tapToOpen" width="187.5" >
            
            <div id="menuItemsBar">
                <div class="menuItem hide" style="-webkit-transform: translateX(0);"><img src="assets/menu/titleIntro.png"     width="618"     style="left: 295px;top: 65px;">
                </div> 
                <div class="menuItem hide" style='height:4161px;'><img src="assets/menu/titleAriete.png"    width="489"     style="left: 360px;top: -96px;">
                </div>
                <div class="menuItem"><img src="assets/menu/titleTorre.png"     width="509"     style="left: 315px;top: -253px;"></div>
                <div class="menuItem"><img src="assets/menu/titleGarra.png"     width="545.5"   style="left: 315px;top: -299.5px;"></div>
                <div class="menuItem"><img src="assets/menu/titleOnagro.png"    width="495.5"   style="left: 345px;top: -92px;"></div>
                <div class="menuItem"><img src="assets/menu/titleBallista.png"  width="423"     style="left: 345px;top: -133px;"></div>
                <div class="menuItem"><img src="assets/menu/titleScorpio.png"   width="378.5"   style="left: 360px;top: -78.5px;"></div>
                <div class="menuItem hide" style='height:4060px;'><img src="assets/menu/titleTrebuchet.png" width="557.5"   style="left: 320px;top: -166px; ">
                </div>
                <div class="menuItem"><img src="assets/menu/titleFogo.png"      width="536"     style="left: 315px;top: -84px;"></div>
                <div class="menuItem"><img src="assets/menu/titleBombarda.png"  width="491"     style="left: 315px;top: -113px;"></div>
                <div class="menuItem"><img src="assets/menu/titleTanque.png"    width="545.5"   style="left: 315px;top: -107px;"></div>
            </div>
        </div>
        
        <script src="scripts/quo.js"></script>
        <script>
            $$('body').ready(function() {
                console.log('body is ready. Calling app.start()');
                app.start();
            });
            
            var app = {
                mainView: $$('#mainView'),
                helpView: $$('#helpScreen'),
                navBar: $$('#navbar'),
                infoModal: $$('#infoModal'),
                bg: $$('#backgroundAnimation'),
                images: [],
            }
            app.menu = {
                seqArray: new Array(),
                rAF: 0,
                itemsCache: 0,
                titlesArray: $$('.menuItem'),
                minititles: ['minititleIntro.png',
                    'minititleAriete.png',
                    'minititleTorre.png',
                    'minititleGarra.png',
                    'minititleOnagro.png',
                    'minititleBallista.png',
                    'minititleScorpio.png',
                    'minititleTrebuchet.png',
                    'minititleFogo.png',
                    'minititleBombarda.png'
                    ,'minititleTanque.png',],
                setaDireita: $$('#setaDireita'),
                setaEsquerda: $$('#setaEsquerda'),
                currentTitle: 0,
                currentBGFrame: 0,
                menuBar: $$('#menuItemsBar')
                
            };
            
            app.audio = {
                state:0 //0=play all, 1=OnlyFX, 2=mute
            }
            
            app.audio.setState = function(s) {
                app.audio.state = s;
            }
            
            app.start = function() {
                // Iniciar o App. Essa será a base para chamar o loader. Por Enquanto deve apenas carregar a animação de BG do menu.
                for (i=0; i<=300; i++){
                    str = 'assets/menu/seq/A/' + addZeros(i,4) + '.png';
                    imgTemp = new Image();
                    imgTemp.src = str;
                    app.images[i] = str;
                }
                
            }
            
            
            
            app.menu.nextItem = function(e) { 
                //Trazer próximo item da direita
                if (app.menu.currentTitle != 10 ) {
                    app.menu.setaEsquerda.removeClass('leaveState');
                    app.menu.nextBG(app.menu.currentTitle + 1);
                    
                    
                    app.menu.titlesArray[app.menu.currentTitle].style.webkitTransform = 'translate3d(-1024px,0,0)';
                    app.menu.currentTitle ++;
                    app.menu.titlesArray[app.menu.currentTitle].style.webkitTransform = 'translate3d(0,0,0)';
                    if (app.menu.currentTitle == 10) {app.menu.setaDireita.addClass('leaveState');}
                }
                
            }
            
            app.menu.nextBG = function(goto) {
                window.cancelAnimationFrame? cancelAnimationFrame(app.menu.rAF): webkitCancelAnimationFrame(app.menu.rAF);
                animLoop = function() {
                    
                    if (app.menu.currentBGFrame  != goto * 30 ) {
                        ++ app.menu.currentBGFrame;
                        app.bg.attr('src', app.images[app.menu.currentBGFrame]);
                        app.menu.rAF = window.requestAnimationFrame? requestAnimationFrame(animLoop): webkitRequestAnimationFrame(animLoop); // polyfill para funcionar no chrome e no ipad(que requer o vendor prefix antes da versão 7)
                    }
                };
                animLoop();
            }
            
            app.menu.previousBG = function(goto) {
                window.cancelAnimationFrame? cancelAnimationFrame(app.menu.rAF): webkitCancelAnimationFrame(app.menu.rAF);
                animLoop = function() {
                    
                    if (app.menu.currentBGFrame  != goto * 30 ) {
                        -- app.menu.currentBGFrame;
                        app.bg.attr('src', app.images[app.menu.currentBGFrame]);
                        app.menu.rAF = window.requestAnimationFrame? requestAnimationFrame(animLoop): webkitRequestAnimationFrame(animLoop); // polyfill para funcionar no chrome e no ipad(que requer o vendor prefix antes da versão 7)
                    }
                };
                animLoop();
            }
            
            app.menu.previousItem = function() { 
                //Trazer item anterior da esquerda
                if (app.menu.currentTitle != 0 ) {
                    app.menu.previousBG(app.menu.currentTitle - 1);             
                    app.menu.setaDireita.removeClass('leaveState');
                    app.menu.titlesArray[app.menu.currentTitle].style.webkitTransform = 'translate3d(1024px,0,0)';
                    app.menu.currentTitle --;
                    app.menu.titlesArray[app.menu.currentTitle].style.webkitTransform = 'translate3d(0,0,0)';
                    if (app.menu.currentTitle == 0) {app.menu.setaEsquerda.addClass('leaveState');}
                }
            }
            
            app.menu.openContent = function(e) {
        
                invento = app.menu.currentTitle;
                title = app.menu.titlesArray[app.menu.currentTitle];
                $$('#BTNtitle').style('background-image', 'url(assets/menu/' + app.menu.minititles[app.menu.currentTitle] + ')');
                app.mainView.addClass('contentMode');
                app.navBar.addClass('contentMode');
                app.bg.addClass('contentMode');
            
                
                $$('.menuItem img').off("tap", app.menu.openContent); // Remover os Listeners do Menu
                $$('#tapToOpen').off("tap", app.menu.openContent);
                app.menu.menuBar.off('swipeLeft', app.menu.nextItem);
                app.menu.menuBar.off('swipeRight', app.menu.previousItem);
                app.menu.setaDireita.off("tap", app.menu.nextItem);
                app.menu.setaEsquerda.off("tap", app.menu.previousItem);
                
                document.removeEventListener('touchmove', lockOverscroll, true) // Remover o listener que bloqueia o scroll no app
                
                
                app.menu.itemsCache = $$(title).siblings().remove();
                
                setTimeout(function(){
                    $$('.menuItem').removeClass('hide');
                }, 200);
           
            }
            
            app.menu.closeContent = function(e) {
                $$('.menuItem').addClass('hide');
                app.mainView.removeClass('contentMode');
                app.navBar.removeClass('contentMode');
                app.bg.removeClass('contentMode');
                app.menu.menuBar.append(app.menu.itemsCache);
                
                $$('.menuItem img').on("tap", app.menu.openContent); // Redefinir os Listeners do Menu 
                $$('#tapToOpen').on("tap", app.menu.openContent);
                app.menu.menuBar.on('swipeLeft', app.menu.nextItem);
                app.menu.menuBar.on('swipeRight', app.menu.previousItem);
                app.menu.setaDireita.on('tap', app.menu.nextItem);
                app.menu.setaEsquerda.on('tap', app.menu.previousItem);
                
                document.addEventListener('touchmove', lockOverscroll, true); // Redefinir o listener que bloqueia o overscroll
            }
            
            
        // Eventos do Menu -----------------
            
            app.menu.menuBar.on('swipeLeft', app.menu.nextItem);
            app.menu.menuBar.on('swipeRight', app.menu.previousItem);
            app.menu.setaDireita.on('tap', app.menu.nextItem);
            app.menu.setaEsquerda.on('tap', app.menu.previousItem);
            
            $$('.menuItem img').on('tap',app.menu.openContent);
            $$('.menuItem img').on('swipeUp',app.menu.openContent);
            $$('#tapToOpen').on('tap',app.menu.openContent);
            $$('#BTNback').on('tap',app.menu.closeContent);
        
        //Eventos da Barra de Navegação ------
            
            $$('#BTNinfo').tap( function() {
                app.infoModal.show();
                setTimeout(function() {app.infoModal.removeClass('hidden');}, 50);
                
                app.infoModal.tap( function() {
                    app.infoModal.addClass('hidden');
                    setTimeout(function() {app.infoModal.hide();}, 50);
                });
            });
                       
            $$('#BTNhelp').on('tap', function() {
                app.helpView.show();
                setTimeout( function() {app.helpView.style('opacity', '1')}, 50 );
            });
            var timer;
            $$('#BTNaudioControl').on('tap', function() {
                console.log('cacete');
                shaker.playHitSound();
                btn = $$('#BTNaudioControl');
                audioState = app.audio.state;
                btn.addClass('tooltip');
                clearTimeout(timer);
                timer = setTimeout(function(){
                    btn.removeClass('tooltip');
                }, 1500);
                switch (audioState) {
                    case 0:
                        btn.removeClass('full');
                        btn.removeClass('hollow');
                        btn.addClass('half');
                        app.audio.setState(1);
                        break;
                    case 1:
                        //mudar sprite para hollow
                        btn.removeClass('full');
                        btn.removeClass('half');
                        btn.addClass('hollow');
                        app.audio.setState(2);
                        break;
                    case 2:
                        //mudar sprite para full
                        btn.removeClass('hollow');
                        btn.removeClass('half');
                        btn.addClass('full');
                        app.audio.setState(0);
                        break;
                }
            });
            
        // Eventos da Ajuda ---------------
            
            app.helpView.on('tap', function() {
                // ao tocar em qualquer parte da tela, fadeOut (transition) e depois display hidden
                app.helpView.style('opacity', '0');
                setTimeout( function() {app.helpView.hide();}, 500);
            });
            
            //Tentativa de bloquear o overscroll/scroll elástico. Funciona, mas bloqueia todo o scroll no app. Nos momentos em que o scroll é necessário, remover o listener
            document.addEventListener('touchmove', lockOverscroll, true);
            
            function lockOverscroll(e) { e.preventDefault(); };
            
        
        // Funções úteis. Nas versões finais, devem ser isoladas em outro arquivo js
            function addZeros(number, length) {
                var num = '' + number;
                while (num.length < length) {
                    num = '0' + num;
                }
                return num;
            }
            
        </script>
    </body>
</html>